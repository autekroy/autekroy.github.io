<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>每天運動</title>
    
    <!-- PWA Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-title" content="每天運動">
    
    <!-- Icon -->
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/13061/13061473.png">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/13061/13061473.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                    },
                    padding: {
                        'safe-top': 'env(safe-area-inset-top)',
                        'safe-bottom': 'env(safe-area-inset-bottom)',
                    },
                    colors: {
                        ios: {
                            bg: '#F2F2F7',
                            card: '#FFFFFF',
                            blue: '#007AFF',
                            green: '#34C759',
                            indigo: '#5856D6',
                            orange: '#FF9500',
                            pink: '#FF2D55',
                            purple: '#AF52DE',
                            red: '#FF3B30',
                            teal: '#5AC8FA',
                            yellow: '#FFCC00',
                            gray: '#8E8E93',
                            gray2: '#AEAEB2',
                            gray3: '#C7C7CC',
                            gray4: '#D1D1D6',
                            gray5: '#E5E5EA',
                            gray6: '#F2F2F7',
                        }
                    },
                    boxShadow: {
                        'soft': '0 8px 30px rgba(0,0,0,0.04)',
                        'glow': '0 0 20px rgba(0,122,255,0.3)',
                    },
                    animation: {
                        'bounce-sm': 'bounce-sm 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'slide-up': 'slideUp 0.3s ease-out forwards',
                    },
                    keyframes: {
                        'bounce-sm': {
                            '0%, 100%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(0.97)' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body { 
            -webkit-tap-highlight-color: transparent; 
            background-color: #F5F7FA;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Smooth transitions */
        .transition-height {
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Glassmorphism utilities */
        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.5);
        }
    </style>
</head>
<body class="antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons ---
        const IconBase = ({ children, size = 24, className = "", strokeWidth = 2.5 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Icons = {
            Check: (p) => <IconBase {...p}><polyline points="20 6 9 17 4 12" /></IconBase>,
            Trophy: (p) => <IconBase {...p}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></IconBase>,
            RotateCcw: (p) => <IconBase {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconBase>,
            ChevronDown: (p) => <IconBase {...p}><polyline points="6 9 12 15 18 9"/></IconBase>,
            ChevronUp: (p) => <IconBase {...p}><polyline points="18 15 12 9 6 15"/></IconBase>,
            Activity: (p) => <IconBase {...p}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></IconBase>,
            Clock: (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconBase>,
            AlertCircle: (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconBase>,
            Dumbbell: (p) => <IconBase {...p}><path d="m6.5 6.5 11 11"/><path d="m21 21-1-1"/><path d="m3 3 1 1"/><path d="m18 22 4-4"/><path d="m2 6 4-4"/><path d="m3 10 7-7"/><path d="m14 21 7-7"/></IconBase>,
            Heart: (p) => <IconBase {...p}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></IconBase>,
            Share: (p) => <IconBase {...p}><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" x2="12" y1="2" y2="15"/></IconBase>,
            X: (p) => <IconBase {...p}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>,
            ArrowDownToLine: (p) => <IconBase {...p}><path d="M12 17V3"/><path d="m6 11 6 6 6-6"/><path d="M19 21H5"/></IconBase>,
            ArrowUpFromLine: (p) => <IconBase {...p}><path d="m18 9-6-6-6 6"/><path d="M12 3v14"/><path d="M5 21h14"/></IconBase>,
            ArrowDown: (p) => <IconBase {...p}><path d="M12 5v14"/><path d="m19 12-7 7-7-7"/></IconBase>,
            Scale: (p) => <IconBase {...p}><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></IconBase>,
            Zap: (p) => <IconBase {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>,
            Footprints: (p) => <IconBase {...p}><path d="M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 11 3.8 11 8c0 2.5-1.03 3.5-1 5.62V16a2 2 0 0 1-2 2 2 2 0 0 1-2-2Z"/><path d="M14 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C8.63 6 7 7.8 7 12c0 2.5 1.03 3.5 1 5.62V20a2 2 0 0 0 2 2 2 2 0 0 0 2-2Z"/></IconBase>,
            Timer: (p) => <IconBase {...p}><line x1="10" x2="14" y1="2" y2="2"/><line x1="12" x2="15" y1="14" y2="11"/><circle cx="12" cy="14" r="8"/></IconBase>,
            Maximize: (p) => <IconBase {...p}><path d="M8 3H5a2 2 0 0 0-2 2v3"/><path d="M21 8V5a2 2 0 0 0-2-2h-3"/><path d="M3 16v3a2 2 0 0 0 2 2h3"/><path d="M16 21h3a2 2 0 0 0 2-2v-3"/></IconBase>,
            Anchor: (p) => <IconBase {...p}><circle cx="12" cy="5" r="3"/><line x1="12" x2="12" y1="22" y2="8"/><path d="M5 12H2a10 10 0 0 0 20 0h-3"/></IconBase>,
            TrendingUp: (p) => <IconBase {...p}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></IconBase>,
            ChevronsDown: (p) => <IconBase {...p}><path d="m7 6 5 5 5-5"/><path d="m7 13 5 5 5-5"/></IconBase>,
            ArrowDownCircle: (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><path d="M12 8v8"/><path d="m8 12 4 4 4-4"/></IconBase>,
            Shield: (p) => <IconBase {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></IconBase>,
            Bug: (p) => <IconBase {...p}><path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/><path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/><path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/><path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/></IconBase>,
            Move: (p) => <IconBase {...p}><polyline points="5 9 2 12 5 15"/><polyline points="9 5 12 2 15 5"/><polyline points="15 19 12 22 9 19"/><polyline points="19 15 22 12 19 9"/><line x1="2" x2="22" y1="12" y2="12"/><line x1="12" x2="12" y1="2" y2="22"/></IconBase>,
            Minus: (p) => <IconBase {...p}><line x1="5" x2="19" y1="12" y2="12"/></IconBase>,
            Slash: (p) => <IconBase {...p}><path d="M22 2 2 22"/></IconBase>,
            Triangle: (p) => <IconBase {...p}><path d="M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/></IconBase>,
            Star: (p) => <IconBase {...p}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></IconBase>
        };

        // --- Data ---
        // Same data, just enhanced metadata for visuals
        const longevityExercises = [
          {
            id: 1,
            title: "伏地挺身",
            desc: "心臟健康指標",
            target: "目標 40 下",
            tips: ["手肘 45 度", "核心收緊", "胸貼地面"],
            detail: "根據研究，能做 40 下伏地挺身的男性，心血管疾病風險顯著較低。這能強化胸肌、三頭肌與核心穩定。",
            intensity: "高強度",
            colorText: "text-blue-600",
            colorBg: "bg-blue-100",
            colorRing: "border-blue-500",
            gradient: "from-blue-500 to-indigo-600",
            Icon: Icons.ArrowDownToLine
          },
          {
            id: 2,
            title: "引體向上",
            desc: "握力與壽命相關",
            target: "懸吊 30秒",
            tips: ["手臂伸直", "肩胛下沉", "不擺盪"],
            detail: "握力強弱與老年生活品質高度相關。如果拉不上去，練習「懸吊 (Dead Hang)」30秒也非常有效。",
            intensity: "高強度",
            colorText: "text-indigo-600",
            colorBg: "bg-indigo-100",
            colorRing: "border-indigo-500",
            gradient: "from-indigo-500 to-purple-600",
            Icon: Icons.ArrowUpFromLine
          },
          {
            id: 3,
            title: "單腿板凳蹲",
            desc: "預防跌倒關鍵",
            target: "每邊 10 下",
            tips: ["慢慢坐下", "膝蓋對齊", "另腳懸空"],
            detail: "無法單腳站立 10 秒的人，死亡風險較高。此動作模擬坐下與站起，強化股四頭肌與平衡。",
            intensity: "中強度",
            colorText: "text-purple-600",
            colorBg: "bg-purple-100",
            colorRing: "border-purple-500",
            gradient: "from-purple-500 to-pink-500",
            Icon: Icons.ArrowDown
          },
          {
            id: 4,
            title: "單腿硬舉",
            desc: "改善背痛與後側鏈",
            target: "每邊 10 下",
            tips: ["背部打直", "髖部後推", "支撐腳微彎"],
            detail: "現代人久坐導致臀腿無力。這能平衡左右肌力，強化腿後側鏈，減少下背疼痛風險。",
            intensity: "中強度",
            colorText: "text-pink-600",
            colorBg: "bg-pink-100",
            colorRing: "border-pink-500",
            gradient: "from-pink-500 to-rose-500",
            Icon: Icons.Scale
          },
          {
            id: 5,
            title: "深蹲跳",
            desc: "維持爆發力",
            target: "10-15 下",
            tips: ["輕盈落地", "膝蓋緩衝", "臀部發力"],
            detail: "40歲後爆發力流失速度比肌力快。維持爆發力能讓你在快跌倒時迅速反應，保持敏捷。",
            intensity: "高強度",
            colorText: "text-orange-600",
            colorBg: "bg-orange-100",
            colorRing: "border-orange-500",
            gradient: "from-orange-500 to-red-500",
            Icon: Icons.Zap
          },
          {
            id: 6,
            title: "單腳跳停",
            desc: "骨質密度與協調",
            target: "穩住 2秒",
            tips: ["跳躍落地", "核心用力", "身體不晃"],
            detail: "高衝擊運動能增加骨質密度。訓練大腦精準控制肢體煞車，有效預防運動傷害。",
            intensity: "中強度",
            colorText: "text-teal-600",
            colorBg: "bg-teal-100",
            colorRing: "border-teal-500",
            gradient: "from-teal-500 to-emerald-500",
            Icon: Icons.Footprints
          },
          {
            id: 7,
            title: "分腿蹲靜態",
            desc: "下肢極致穩定",
            target: "保持 30秒",
            tips: ["後膝離地", "身體正直", "骨盆擺正"],
            detail: "等長收縮 (Isometric) 能建立強大的關節穩定性，並伸展緊繃的髖屈肌，適合久坐族。",
            intensity: "低強度",
            colorText: "text-red-600",
            colorBg: "bg-red-100",
            colorRing: "border-red-500",
            gradient: "from-red-500 to-orange-500",
            Icon: Icons.Timer
          }
        ];

        const coreExercises = [
            {
                id: 201,
                title: "死蟲式",
                desc: "脊椎友善核心啟動",
                target: "每邊 15 下",
                tips: ["下背貼地", "動作緩慢", "手腳延伸"],
                detail: "【絕對不傷腰】的核心動作。躺在地上，下背用力壓住地板（不要有空隙），對側手腳慢慢延伸出去再回來。",
                intensity: "基礎",
                colorText: "text-yellow-600",
                colorBg: "bg-yellow-100",
                colorRing: "border-yellow-500",
                gradient: "from-yellow-400 to-orange-500",
                Icon: Icons.Bug
            },
            {
                id: 202,
                title: "標準棒式",
                desc: "全身抗伸展穩定",
                target: "保持 45秒",
                tips: ["身體直線", "臀部夾緊", "手肘在肩下"],
                detail: "核心訓練之王。重點是「不要塌腰」和「不要翹屁股」。如果覺得腰痠，請先縮短時間。",
                intensity: "中強度",
                colorText: "text-lime-600",
                colorBg: "bg-lime-100",
                colorRing: "border-lime-500",
                gradient: "from-lime-400 to-green-500",
                Icon: Icons.Minus
            },
            {
                id: 203,
                title: "鳥狗式",
                desc: "背部穩定與協調",
                target: "每邊 10 下",
                tips: ["軀幹平穩", "手腳延伸", "骨盆不歪"],
                detail: "四足跪姿，對側手腳延伸。想像你背上放了一杯水，動作過程中不能讓水灑出來。",
                intensity: "基礎",
                colorText: "text-cyan-600",
                colorBg: "bg-cyan-100",
                colorRing: "border-cyan-500",
                gradient: "from-cyan-400 to-blue-500",
                Icon: Icons.Move
            },
            {
                id: 204,
                title: "臀橋",
                desc: "啟動臀肌與後側",
                target: "20 下",
                tips: ["臀部發力", "腳跟踩穩", "頂點停1秒"],
                detail: "躺姿，雙腳踩地。用屁股的力量把髖部頂起來。這能改善「臀肌失憶症」，並減輕下背負擔。",
                intensity: "中強度",
                colorText: "text-fuchsia-600",
                colorBg: "bg-fuchsia-100",
                colorRing: "border-fuchsia-500",
                gradient: "from-fuchsia-400 to-purple-500",
                Icon: Icons.Triangle
            },
            {
                id: 205,
                title: "側棒式",
                desc: "側腹與髖部穩定",
                target: "每邊 30秒",
                tips: ["身體直線", "腰部頂起", "肩膀下沉"],
                detail: "側躺，用手肘撐起身體。這能訓練到側腹肌（腹外斜肌）和臀中肌，對於穩定骨盆、減少走路搖晃非常有幫助。",
                intensity: "高強度",
                colorText: "text-violet-600",
                colorBg: "bg-violet-100",
                colorRing: "border-violet-500",
                gradient: "from-violet-400 to-indigo-500",
                Icon: Icons.Slash
            }
        ];

        const stretchingExercises = [
          {
            id: 101,
            title: "全身與背部拉伸",
            desc: "拉開身體架構",
            target: "開胸 / 側彎",
            tips: ["重心前移", "手插腰側彎", "改善駝背"],
            detail: "【牆角開胸】找個門框，雙手抵住兩側，重心前移拉開胸肌。【站姿體側伸展】一手插腰，一手向上延伸側彎。",
            intensity: "放鬆",
            colorText: "text-emerald-600",
            colorBg: "bg-emerald-100",
            colorRing: "border-emerald-500",
            gradient: "from-emerald-400 to-teal-600",
            Icon: Icons.Maximize
          },
          {
            id: 102,
            title: "臀部放鬆 (4字型)",
            desc: "減輕大腿負擔",
            target: "各 60秒",
            tips: ["腳踝跨膝", "背打直", "腳尖勾起"],
            detail: "腿部痠痛往往跟臀部緊繃有關。坐在椅子上，將腳踝跨在另一膝上，背打直慢慢前傾，感受屁股深處的酸爽。",
            intensity: "放鬆",
            colorText: "text-cyan-600",
            colorBg: "bg-cyan-100",
            colorRing: "border-cyan-500",
            gradient: "from-cyan-400 to-blue-500",
            Icon: Icons.Anchor
          },
          {
            id: 103,
            title: "大腿前側與髖",
            desc: "放鬆久坐緊繃",
            target: "各 60秒",
            tips: ["單手抓腳踝", "骨盆前頂", "拉伸大腿"],
            detail: "一手扶椅背保持平衡，一手抓同側腳踝後拉。進階技巧：拉住腳踝時「夾屁股」，能拉到大腿前側靠近根部的地方。",
            intensity: "伸展",
            colorText: "text-sky-600",
            colorBg: "bg-sky-100",
            colorRing: "border-sky-500",
            gradient: "from-sky-400 to-blue-500",
            Icon: Icons.TrendingUp
          },
          {
            id: 104,
            title: "大腿後側與外側",
            desc: "舒緩久站痠痛",
            target: "勾腳 / 交叉腿",
            tips: ["屁股後推", "背部不拱", "交叉前彎"],
            detail: "【勾腳尖翹臀】一腳前跨勾腳尖，屁股後推（像要坐下）。【交叉腿前彎】雙腳交叉站立後彎腰摸地，拉伸大腿外側。",
            intensity: "伸展",
            colorText: "text-rose-600",
            colorBg: "bg-rose-100",
            colorRing: "border-rose-500",
            gradient: "from-rose-400 to-red-600",
            Icon: Icons.ChevronsDown
          },
          {
            id: 105,
            title: "深度小腿放鬆",
            desc: "對付頑固痠痛",
            target: "踩階梯下壓",
            tips: ["腳跟下沉", "膝蓋打直", "膝蓋微彎"],
            detail: "比推牆更深層！前腳掌踩階梯邊緣，腳跟慢慢下沉。記得「膝蓋打直」和「膝蓋微彎」兩種都要做，分別放鬆不同肌肉。",
            intensity: "深層",
            colorText: "text-amber-600",
            colorBg: "bg-amber-100",
            colorRing: "border-amber-500",
            gradient: "from-amber-400 to-orange-500",
            Icon: Icons.ArrowDownCircle
          }
        ];

        // --- Components ---

        const TabButton = ({ active, onClick, icon: Icon, label, activeColor }) => {
            return (
                <button 
                    onClick={onClick}
                    className={`relative flex-1 py-3 flex flex-col items-center justify-center gap-1 transition-all duration-300 ${active ? activeColor : 'text-gray-400 hover:text-gray-500'}`}
                >
                    <div className={`p-1 rounded-full transition-all duration-300 ${active ? 'bg-current/10 scale-110' : ''}`}>
                        <Icon size={22} strokeWidth={active ? 3 : 2} />
                    </div>
                    <span className="text-[10px] font-bold tracking-wide">{label}</span>
                    {active && <div className="absolute -bottom-1 w-1 h-1 rounded-full bg-current" />}
                </button>
            )
        };

        const ProgressBar = ({ progress, colorClass }) => (
            <div className="relative w-12 h-12 group">
                 <svg className="w-full h-full transform -rotate-90">
                    <circle cx="24" cy="24" r="20" stroke="#E5E7EB" strokeWidth="4" fill="none" />
                    <circle 
                        cx="24" cy="24" r="20" 
                        stroke="currentColor" 
                        strokeWidth="4" 
                        fill="none" 
                        strokeDasharray="126" 
                        strokeDashoffset={126 - (126 * progress) / 100} 
                        strokeLinecap="round" 
                        className={`transition-all duration-1000 ease-out ${colorClass}`} 
                    />
                </svg>
                <div className={`absolute inset-0 flex items-center justify-center text-[10px] font-bold ${colorClass}`}>
                    {progress}%
                </div>
            </div>
        );

        function App() {
            const [activeTab, setActiveTab] = useState('longevity');
            const [completed, setCompleted] = useState({});
            const [expanded, setExpanded] = useState(null);
            const [showResetConfirm, setShowResetConfirm] = useState(false);
            const [showInstallGuide, setShowInstallGuide] = useState(false);
            const [scrolled, setScrolled] = useState(false);

            let currentData;
            let themeColor;
            let themeGradient;
            
            if (activeTab === 'longevity') {
                currentData = longevityExercises;
                themeColor = 'text-blue-500';
                themeGradient = 'from-blue-600 to-indigo-600';
            } else if (activeTab === 'core') {
                currentData = coreExercises;
                themeColor = 'text-yellow-500';
                themeGradient = 'from-yellow-500 to-orange-500';
            } else {
                currentData = stretchingExercises;
                themeColor = 'text-emerald-500';
                themeGradient = 'from-emerald-500 to-teal-600';
            }

            // Handle scroll effect
            useEffect(() => {
                const handleScroll = () => setScrolled(window.scrollY > 20);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            // Generate PWA Icon
            useEffect(() => {
                const generateAppIcon = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = 512;
                    canvas.height = 512;
                    const ctx = canvas.getContext('2d');
                    if (ctx) {
                        const gradient = ctx.createLinearGradient(0, 0, 0, 512);
                        gradient.addColorStop(0, '#2563EB'); 
                        gradient.addColorStop(1, '#1E40AF'); 
                        ctx.fillStyle = gradient;
                        ctx.fillRect(0, 0, 512, 512);
                        ctx.fillStyle = '#FFFFFF';
                        ctx.font = 'bold 320px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText('7', 256, 270);
                        return canvas.toDataURL('image/png');
                    }
                    return '';
                };
                const iconUrl = generateAppIcon();
                if (iconUrl) {
                    let linkIcon = document.querySelector('link[rel="apple-touch-icon"]');
                    if (!linkIcon) {
                        linkIcon = document.createElement('link');
                        linkIcon.rel = 'apple-touch-icon';
                        document.head.appendChild(linkIcon);
                    }
                    linkIcon.href = iconUrl;
                }
            }, []);

            // LocalStorage Logic
            useEffect(() => {
                try {
                    const saved = localStorage.getItem('dailyFitnessV11');
                    if (saved) {
                        const { date, data } = JSON.parse(saved);
                        if (date === new Date().toDateString()) {
                            setCompleted(data);
                        }
                    }
                } catch (e) { console.error(e); }
            }, []);

            useEffect(() => {
                localStorage.setItem('dailyFitnessV11', JSON.stringify({
                    date: new Date().toDateString(),
                    data: completed
                }));
            }, [completed]);

            const toggle = (id, e) => {
                e?.stopPropagation();
                const isNowDone = !completed[id];
                setCompleted(prev => ({ ...prev, [id]: isNowDone }));
                
                if (isNowDone) {
                    // Slight vibration for mobile if supported
                    if (navigator.vibrate) navigator.vibrate(50);
                    
                    const currentIds = currentData.map(ex => ex.id);
                    const otherDoneCount = currentIds.filter(cid => cid !== id && completed[cid]).length;
                    if (otherDoneCount === currentIds.length - 1) {
                        confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 }, zIndex: 100, colors: ['#60A5FA', '#34D399', '#FBBF24', '#F87171'] });
                    }
                }
            };

            const handleReset = () => {
                const currentIds = currentData.map(e => e.id);
                setCompleted(prev => {
                    const newState = { ...prev };
                    currentIds.forEach(id => delete newState[id]);
                    return newState;
                });
                setExpanded(null);
                setShowResetConfirm(false);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const currentCompletedCount = currentData.filter(ex => completed[ex.id]).length;
            const progress = Math.round((currentCompletedCount / currentData.length) * 100);
            const todayStr = new Date().toLocaleDateString('zh-TW', { month: 'long', day: 'numeric', weekday: 'short' });

            const getTitle = () => {
                if (activeTab === 'longevity') return '長壽運動 7 式';
                if (activeTab === 'core') return '核心強化地基';
                return '全身伸展放鬆';
            };

            return (
                <div className="min-h-screen pb-32">
                    
                    {/* Header - Glassmorphism */}
                    <div className={`fixed top-0 left-0 right-0 z-40 transition-all duration-300 ${scrolled ? 'glass shadow-sm' : 'bg-transparent'}`}>
                        <div className="max-w-md mx-auto px-6 py-4 pt-safe-top">
                            <div className="flex justify-between items-center">
                                <div>
                                    <p className={`text-[10px] font-bold uppercase tracking-widest mb-0.5 transition-colors ${scrolled ? 'text-gray-400' : 'text-gray-500'}`}>{todayStr}</p>
                                    <h1 className="text-2xl font-black text-gray-900 tracking-tight">{getTitle()}</h1>
                                </div>
                                <div className="flex gap-4 items-center">
                                    <button 
                                        onClick={() => setShowInstallGuide(true)} 
                                        className="w-10 h-10 rounded-full bg-white/50 backdrop-blur-sm border border-gray-100 text-gray-500 hover:bg-white flex items-center justify-center transition-all shadow-sm active:scale-95"
                                    >
                                        <Icons.Share size={18} />
                                    </button>
                                    <ProgressBar progress={progress} colorClass={themeColor} />
                                </div>
                            </div>
                        </div>
                    </div>

                    <main className="max-w-md mx-auto px-5 pt-24 space-y-5">
                        {/* Hero Card - Shows when progress is low */}
                        {progress < 100 && (
                            <div className={`relative overflow-hidden rounded-[2rem] p-6 shadow-lg shadow-gray-200/50 text-white animate-in bg-gradient-to-br ${themeGradient}`}>
                                <div className="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white/20 rounded-full blur-xl"></div>
                                <div className="absolute bottom-0 left-0 -mb-4 -ml-4 w-20 h-20 bg-black/10 rounded-full blur-xl"></div>
                                
                                <div className="relative z-10 flex items-start justify-between">
                                    <div>
                                        <div className="flex items-center gap-2 mb-2">
                                            <span className="bg-white/20 backdrop-blur-md px-2 py-0.5 rounded text-[10px] font-bold border border-white/10">今日目標</span>
                                        </div>
                                        <h2 className="text-xl font-bold mb-2 leading-tight">
                                            {activeTab === 'longevity' ? '檢測身體老化指標' : activeTab === 'core' ? '建立穩固的核心' : '放鬆身心靈'}
                                        </h2>
                                        <p className="text-white/90 text-xs leading-relaxed max-w-[260px] font-medium">
                                            {activeTab === 'longevity' ? '完成這 7 個動作，看看你的身體年齡是否比實際更年輕。' : activeTab === 'core' ? '每天一點核心訓練，遠離腰酸背痛，體態更優美。' : '別讓緊繃累積過夜。透過伸展找回身體的柔軟度。'}
                                        </p>
                                    </div>
                                    <div className="bg-white/20 p-2.5 rounded-2xl backdrop-blur-md shadow-inner border border-white/10">
                                        {activeTab === 'longevity' ? <Icons.Activity className="text-white" /> : activeTab === 'core' ? <Icons.Shield className="text-white" /> : <Icons.Heart className="text-white" />}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Exercise Cards */}
                        <div className="space-y-4">
                            {currentData.map((ex) => {
                                const isDone = completed[ex.id];
                                const isExpanded = expanded === ex.id;
                                const CurrentIcon = ex.Icon || Icons.Dumbbell;

                                return (
                                    <div 
                                        key={ex.id} 
                                        onClick={() => setExpanded(isExpanded ? null : ex.id)} 
                                        className={`
                                            relative bg-white rounded-[1.5rem] overflow-hidden transition-all duration-500 ease-out cursor-pointer group
                                            ${isExpanded ? 'shadow-2xl shadow-gray-200 ring-1 ring-gray-100 z-10 scale-[1.02]' : 'shadow-soft hover:shadow-lg hover:-translate-y-0.5'}
                                            ${isDone ? 'ring-2 ring-green-100 bg-green-50/30' : ''}
                                        `}
                                    >
                                        <div className="p-5 flex items-center gap-5">
                                            {/* Icon Box */}
                                            <div className={`
                                                w-14 h-14 rounded-2xl flex items-center justify-center flex-shrink-0 shadow-sm transition-all duration-500
                                                ${isDone 
                                                    ? 'bg-green-500 text-white scale-90 rotate-3' 
                                                    : `${ex.colorBg} ${ex.colorText} group-hover:scale-105`}
                                            `}>
                                                {isDone ? <Icons.Check size={26} strokeWidth={3} /> : <CurrentIcon size={26} />}
                                            </div>

                                            {/* Text Info */}
                                            <div className="flex-1 min-w-0 py-1">
                                                <div className="flex items-center gap-2 mb-1">
                                                    <span className={`text-[10px] font-bold px-2 py-0.5 rounded-md ${isDone ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-500'}`}>
                                                        {ex.intensity}
                                                    </span>
                                                    {isDone && <span className="text-[10px] font-bold text-green-600 animate-slide-up">已完成</span>}
                                                </div>
                                                <h3 className={`text-base font-bold text-gray-900 leading-tight transition-all ${isDone && 'text-gray-400 line-through decoration-gray-300'}`}>
                                                    {ex.title}
                                                </h3>
                                                <p className="text-xs text-gray-400 font-medium truncate mt-0.5">{ex.desc}</p>
                                            </div>

                                            {/* Action Button */}
                                            <div className="flex-shrink-0">
                                                <button 
                                                    onClick={(e) => toggle(ex.id, e)} 
                                                    className={`
                                                        w-11 h-11 rounded-full flex items-center justify-center transition-all duration-300 active:scale-75
                                                        ${isDone 
                                                            ? 'bg-transparent text-green-500' 
                                                            : 'bg-gray-50 text-gray-300 group-hover:bg-gray-100 group-hover:text-gray-400'}
                                                    `}
                                                >
                                                    {isDone 
                                                        ? <div className="bg-green-100 p-2 rounded-full"><Icons.Star size={18} className="fill-current" /></div>
                                                        : <div className="w-5 h-5 rounded-full border-2 border-gray-300"></div>
                                                    }
                                                </button>
                                            </div>
                                        </div>

                                        {/* Expanded Content */}
                                        <div className={`transition-height duration-500 ease-out overflow-hidden ${isExpanded ? 'max-h-[800px] opacity-100' : 'max-h-0 opacity-0'}`}>
                                            <div className="px-5 pb-6 pt-0">
                                                <div className={`h-1 w-12 rounded-full mb-5 bg-gradient-to-r ${ex.gradient}`}></div>
                                                
                                                <div className="space-y-5">
                                                    {/* Target Box */}
                                                    <div className="flex items-start gap-3 bg-gray-50 p-4 rounded-2xl border border-gray-100/50">
                                                        <div className="bg-white p-2 rounded-xl shadow-sm text-gray-400">
                                                            <Icons.Clock size={16} />
                                                        </div>
                                                        <div>
                                                            <p className="text-[10px] font-bold text-gray-400 uppercase tracking-wide mb-0.5">訓練目標</p>
                                                            <p className="text-sm font-bold text-gray-800">{ex.target}</p>
                                                        </div>
                                                    </div>

                                                    {/* Tips */}
                                                    <div>
                                                        <p className="text-[10px] font-bold text-gray-400 uppercase tracking-wide mb-3">動作要點</p>
                                                        <div className="flex flex-wrap gap-2">
                                                            {ex.tips.map((tip, i) => (
                                                                <span key={i} className="text-xs bg-white text-gray-600 px-3 py-1.5 rounded-lg border border-gray-100 font-bold shadow-sm">
                                                                    {tip}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    </div>

                                                    {/* Detail */}
                                                    <div className="text-sm text-gray-600 leading-relaxed bg-white/50 p-4 rounded-2xl border border-gray-100">
                                                        <span className={`font-bold ${ex.colorText}`}>專家指導：</span>
                                                        {ex.detail}
                                                    </div>

                                                    {/* Big Action Button */}
                                                    <button 
                                                        onClick={(e) => { toggle(ex.id, e); setTimeout(() => setExpanded(null), 300); }} 
                                                        className={`
                                                            w-full py-4 rounded-2xl font-bold text-sm shadow-lg transition-all duration-300 active:scale-95 flex items-center justify-center gap-2 text-white
                                                            ${isDone 
                                                                ? 'bg-gray-400 shadow-gray-200' 
                                                                : `bg-gradient-to-r ${ex.gradient} shadow-blue-200/50`}
                                                        `}
                                                    >
                                                        {isDone ? '取消完成' : '完成動作'} 
                                                        {!isDone && <Icons.Check size={18} />}
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                        
                        <div className="h-6"></div>
                        
                        {/* Subtle Reset Button */}
                        <div className="flex justify-center">
                            <button 
                                onClick={() => setShowResetConfirm(true)} 
                                className="text-gray-300 hover:text-red-400 text-xs font-bold py-2 px-4 rounded-full transition-colors flex items-center gap-2"
                            >
                                <Icons.RotateCcw size={12} /> 重置今日進度
                            </button>
                        </div>
                    </main>

                    {/* Bottom Floating Navigation (Simulated iOS Tab Bar) */}
                    <div className="fixed bottom-0 left-0 right-0 z-50">
                        <div className="absolute inset-0 bg-gradient-to-t from-white via-white/90 to-transparent h-32 pointer-events-none"></div>
                        <div className="relative max-w-md mx-auto px-6 pb-safe-bottom">
                            <div className="bg-white/80 backdrop-blur-xl border border-white/50 shadow-[0_8px_32px_rgba(0,0,0,0.12)] rounded-[2rem] p-1.5 flex justify-between items-center mb-6">
                                <TabButton 
                                    active={activeTab === 'longevity'} 
                                    onClick={() => { setActiveTab('longevity'); setExpanded(null); window.scrollTo({top:0, behavior:'smooth'}); }} 
                                    icon={Icons.Dumbbell} 
                                    label="長壽"
                                    activeColor="text-blue-500"
                                />
                                <div className="w-px h-6 bg-gray-200"></div>
                                <TabButton 
                                    active={activeTab === 'core'} 
                                    onClick={() => { setActiveTab('core'); setExpanded(null); window.scrollTo({top:0, behavior:'smooth'}); }} 
                                    icon={Icons.Shield} 
                                    label="核心" 
                                    activeColor="text-yellow-500"
                                />
                                <div className="w-px h-6 bg-gray-200"></div>
                                <TabButton 
                                    active={activeTab === 'stretching'} 
                                    onClick={() => { setActiveTab('stretching'); setExpanded(null); window.scrollTo({top:0, behavior:'smooth'}); }} 
                                    icon={Icons.Heart} 
                                    label="伸展" 
                                    activeColor="text-emerald-500"
                                />
                            </div>
                        </div>
                    </div>

                    {/* Modals */}
                    
                    {/* Install Guide Modal */}
                    {showInstallGuide && (
                        <div className="fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-4">
                            <div className="absolute inset-0 bg-black/30 backdrop-blur-sm transition-opacity" onClick={() => setShowInstallGuide(false)}></div>
                            <div className="bg-white w-full max-w-sm rounded-[2.5rem] p-8 relative z-10 shadow-2xl animate-in slide-in-from-bottom duration-300">
                                <div className="flex justify-between items-center mb-8">
                                    <h3 className="text-xl font-black text-gray-900">安裝 App</h3>
                                    <button onClick={() => setShowInstallGuide(false)} className="p-2 bg-gray-50 rounded-full text-gray-400 hover:bg-gray-100"><Icons.X size={20}/></button>
                                </div>
                                <div className="space-y-6">
                                    <div className="flex gap-5 items-center">
                                        <div className="w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center font-black text-lg shadow-sm flex-shrink-0">1</div>
                                        <div className="flex-1">
                                            <p className="text-sm text-gray-600 font-bold mb-1">點擊下方「分享」按鈕</p>
                                            <div className="flex text-blue-500"><Icons.Share /></div>
                                        </div>
                                    </div>
                                    <div className="w-px h-6 bg-gray-100 ml-5"></div>
                                    <div className="flex gap-5 items-center">
                                        <div className="w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center font-black text-lg shadow-sm flex-shrink-0">2</div>
                                        <div className="flex-1"><p className="text-sm text-gray-600 font-bold">選擇「加入主畫面」</p></div>
                                    </div>
                                    <div className="w-px h-6 bg-gray-100 ml-5"></div>
                                    <div className="flex gap-5 items-center">
                                        <div className="w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center font-black text-lg shadow-sm flex-shrink-0">3</div>
                                        <div className="flex-1"><p className="text-sm text-gray-600 font-bold">點擊右上角「加入」</p></div>
                                    </div>
                                </div>
                                <button onClick={() => setShowInstallGuide(false)} className="w-full mt-10 py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-2xl shadow-lg shadow-blue-200 transition-transform active:scale-95">知道了</button>
                            </div>
                        </div>
                    )}

                    {/* Reset Confirm Modal */}
                    {showResetConfirm && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-6">
                            <div className="absolute inset-0 bg-black/30 backdrop-blur-sm" onClick={() => setShowResetConfirm(false)}></div>
                            <div className="bg-white rounded-[2.5rem] p-8 w-full max-w-sm relative z-10 shadow-2xl animate-in fade-in zoom-in duration-200">
                                <div className="flex flex-col items-center text-center">
                                    <div className="w-16 h-16 bg-red-50 text-red-500 rounded-full flex items-center justify-center mb-5 shadow-sm border border-red-100"><Icons.AlertCircle size={32} /></div>
                                    <h3 className="text-xl font-black text-gray-900 mb-2">確定重置？</h3>
                                    <p className="text-sm text-gray-500 mb-8 font-medium">這將會清除「{getTitle()}」的所有打卡紀錄。</p>
                                    <div className="flex gap-4 w-full">
                                        <button onClick={() => setShowResetConfirm(false)} className="flex-1 py-4 bg-gray-50 rounded-2xl font-bold text-gray-500 text-sm hover:bg-gray-100">取消</button>
                                        <button onClick={handleReset} className="flex-1 py-4 bg-red-500 rounded-2xl font-bold text-white text-sm shadow-lg shadow-red-200 hover:bg-red-600 active:scale-95 transition-transform">確定重置</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
